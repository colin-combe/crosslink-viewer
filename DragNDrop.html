<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta charset="utf-8">
  <title>xiNET cross-link viewer | Demo</title>
  <link rel="stylesheet" href="./css/XLV.css" type="text/css">
  <link rel="stylesheet" href="./css/demo.css" type="text/css">
  <link rel="stylesheet" href="./css/bootstrap.css" type="text/css">
  
  <!--libraries-->
  <script type="text/javascript" src="./lib/jquery.js"></script>
  <script type="text/javascript" src="./lib/d3.js"></script>
  <script type="text/javascript" src="./lib/colorbrewer.js"></script>
  <script type="text/javascript" src="./lib/jsdas.js"></script>
  <script type="text/javascript" src="./lib/rgbcolor.js"></script>
  <script type="text/javascript" src="./lib/prototype.js"></script>
  <script type="text/javascript" src="./lib/slider.js"></script>
  <script type="text/javascript" src="./lib/bootstrap.js"></script>
  <!--xiNET-->
  <script type="text/javascript" src="./js/controller/Init.js"></script>
  <script type="text/javascript" src="./js/controller/MouseEvents.js"></script>
  <script type="text/javascript" src="./js/controller/Layout.js"></script>
  <script type="text/javascript">
//<![CDATA[
                
                //?
                
  //~ xinet.Controller.prototype.checkLinks=function(){if(this.initComplete){var suspendID=this.svgElement.suspendRedraw(5000);var links=this.proteinLinks.values();var linkCount=links.length;for(var l=0;l<linkCount;l++){var link=links[l];link.check();}
  //~ this.svgElement.unsuspendRedraw(suspendID);}};xinet.Controller.prototype.scale=function(){var suspendID=this.svgElement.suspendRedraw(5000);if(this.initComplete){this.z=this.container.getScreenCTM().inverse().a;var proteins=this.proteins.values();var proteinCount=proteins.length;for(var p=0;p<proteinCount;p++){var prot=proteins[p];prot.setPosition(prot.x,prot.y);if(prot.form!==0)
  //~ prot.setAllLineCoordinates();}
  //~ var links=this.proteinLinks.values();var linkCount=links.length;for(var l=0;l<linkCount;l++){var protLink=links[l];if(protLink.fromProtein!==protLink.toProtein){if(!protLink.fromProtein.isParked&&!protLink.toProtein.isParked){if(protLink.fromProtein.form===0&&protLink.toProtein.form===0){protLink.line.setAttribute("stroke-width",this.z*xinet.linkWidth);protLink.highlightLine.setAttribute("stroke-width",this.z*10);protLink.fatLine.setAttribute("stroke-width",this.z*protLink.w);if(protLink.ambig){protLink.dashedLine(true);}}
  //~ else{var c2=protLink.residueLinks.keys().length;for(var rl=0;rl<c2;rl++){var resLink=protLink.residueLinks.values()[rl];if(resLink.check()){protLink.residueLinks.values()[rl].line.setAttribute("stroke-width",this.z*xinet.linkWidth);protLink.residueLinks.values()[rl].highlightLine.setAttribute("stroke-width",this.z*10);if(resLink.ambig){resLink.dashedLine(true);}}}}}}}}
  //~ this.svgElement.unsuspendRedraw(suspendID);};

                                //]]>
  </script>
  <script type="text/javascript" src="./js/controller/Refresh.js"></script>
  <script type="text/javascript" src="./js/controller/ToolTips.js"></script>
  <script type="text/javascript" src="./js/controller/Fasta.js"></script>
  <script type="text/javascript" src="./js/model/Match.js"></script>
  <script type="text/javascript" src="./js/model/Link.js"></script>
  <script type="text/javascript" src="./js/model/Protein.js"></script>
  <script type="text/javascript" src="./js/model/Annotations.js"></script>
  <script type="text/javascript" src="./js/model/ProteinLink.js"></script>
  <script type="text/javascript" src="./js/model/Rotator.js"></script>
  <script type="text/javascript" src="./js/model/ResidueLink.js"></script>
  <script type="text/javascript" src="./js/controller/ExternalControls.js"></script>
  <script type="text/javascript" src="./js/controller/DASUtil.js"></script>
  <script type="text/javascript" src="./js/controller/ReadXQuest.js"></script>
  <script type="text/javascript" src="./lib/bootstrap.js"></script>
</head>
<body>
    <div>
<nav class="navbar navbar-inverse" role="navigation">
    <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="#">Crosslink-Viewer</a>

  </div>
        <p class="navbar-text pull-right">Modified by <a href="mailto://hendrik@die-hofstadts.de" class="navbar-link">Hendrik H.</a></p>
<p class="navbar-text pull-right">Developed by <a href="http://rappsilberlab.org//people/colin-combe/" class="navbar-link">Colin Combe</a>, <a href="http://rappsilberlab.org/" class="navbar-link">RAPPSILBER LABORATORY</a></p>

</nav>
</div>
<div class="container max-width">


        <div class="well">
        <div class="panel panel-default">
  <div class="panel-body">
                <!--TODO: change exportSVG so param not needed?-->
			<button class="btn btn-primary" onclick="help()">HELP</button>
			<button type='button' class="btn btn-primary" id='exportSVG'  onclick="xlv.exportSVG('networkSVG');">Export SVG</button>
            
            <button type="button" class="btn btn-primary" id="autoLayout" onclick="xlv.autoLayout();">Auto</button>
            <button type="button" class="btn btn-primary" id="resetViewport" onclick="xlv.resetZoom();">Reset zoom</button>
           Self links   <input checked="checked" id="internal" onclick="xlv.hideInternal(!document.getElementById('internal').checked)" type="checkbox">
            
<div style=" float:right " class="outlined" id="scoreSlider">
<div id="track1" style="width:200px; background-color:#fff;-webkit-box-shadow: inset 1px 1px 1px 1px #999;box-shadow: inset 1px 1px 1px 1px #999; height:15px;display:inline-block;">
<div class="selected" id="handle1" style="width: 30px; height: 14px; border: solid #000 1px; background-color: #777; cursor: move; left: 0px; position: relative; "></div>
</div>
<p id="debug1" style="display:inline-block;width:140px">score cut-off: </p>
      </div>
  </div>
</div>



            <div style="height:600px" id="networkContainer"></div>
            <div class="panel panel-default">
  <div class="panel-body">
       <div id="networkCaption"><p style="width:100%;text-align: center;"><strong>DOUBLE CLICK interactors to toggle between blob and stick</strong></p></div>
        </div>
  </div>
</div>
        

<script type="text/javascript">
                    //<![CDATA[
                    var targetDiv = document.getElementById('networkContainer');
                    var messageDiv = document.getElementById('networkCaption');
                    var xlv = new xinet.Controller(targetDiv);
                    xlv.setMessageElement(messageDiv);
					var holder = document.getElementById('networkContainer');
					mode = 1;
		holder.ondragover = function () { this.className = 'hover'; return false; };
holder.ondragend = function () { this.className = ''; return false; };
holder.ondrop = function (e) {
  this.className = '';
  e.preventDefault();

  var file = e.dataTransfer.files[0],
      reader = new FileReader();
  reader.onload = function (event) {
	  if(mode == 0){
		  d3.text(event.target.result, "text/csv", function(text) {
					xlv.readCSV(text);
				});
	  }
	  else{
		  d3.text(event.target.result, "text/plain", function(text) {
					xlv.readFasta(text);
		 
				});
				mode = 0;
		 
	  }
				
  };
  reader.readAsDataURL(file);

  return false;
};
                    xlv.init();

                    //new xinet.DASUtil(xlv);
//                    var proteins = xlv.proteins.values();
//                    var proteinCount = proteins.length;
//
//                    for (var p = 0; p < proteinCount; p++) {
//                        var prot = proteins[p];
//    //            prot.setPositionalFeatures(prot.customAnnotations);
//                    }

                    xlv.checkLinks();

//                    function send_match_ids(ids) {
//                        //xlv.message(ids);
//                        var message = '<pre>\n';
//                        var splitIds = ids.split(',');
//                        for (var i = 0; i < splitIds.length; i++) {
//                            var id = splitIds[i];
//                            message += id + ': ' + JSON.stringify(xlv.matches.get(id).meta) + '\n';
//                        }
//                        message += '</pre>';
//                        xlv.message(message);
//                    }

                new Control.Slider('handle1', 'track1', {
                    sliderValue: 0,
                    onSlide: function(v) {
                        var cut = calcCutOff(v);
                        $('debug1').innerHTML = 'score cut-off: ' + cut;
                        xlv.setCutOff(cut);
                    },
                    onChange: function(v) {
                        var cut = calcCutOff(v);
                        $('debug1').innerHTML = 'score cut-off: ' + cut;
                        xlv.setCutOff(cut);
                    }
                });

                function calcCutOff(v) {
                    var result = (v * (xlv.scores.max - xlv.scores.min)) + xlv.scores.min;
                    result = result.toFixed(2);
                    return result;
                }

                    //]]>
    </script>
  </div>
</body>
</html>
